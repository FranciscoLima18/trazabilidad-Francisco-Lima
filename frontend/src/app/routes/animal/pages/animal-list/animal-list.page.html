<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button fill="clear" [routerLink]="['/dashboard']">
        <ion-icon slot="icon-only" name="home-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Lista de Animales</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="goToMap()">
        <ion-icon slot="icon-only" name="map-outline"></ion-icon>
      </ion-button>
      @if (canCreateAnimals()) {
      <ion-button [routerLink]="['/animal/create']" fill="clear">
        <ion-icon slot="icon-only" name="add-outline"></ion-icon>
      </ion-button>
      } @else {
      <ion-badge color="medium">Solo lectura</ion-badge>
      }
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Filters Section -->
  <app-animal-filters
    [speciesList]="speciesList()"
    [regionsList]="regionsList()"
    [initialSpecies]="speciesFilter()"
    [initialRegion]="regionFilter()"
    [initialFromDate]="fromDate()"
    [initialToDate]="toDate()"
    (filtersApplied)="onFiltersApplied($event)"
    (filtersCleared)="onFiltersCleared()"
  >
  </app-animal-filters>

  <!-- Animal List -->
  <div class="animals-container ion-padding">
    @if (loading()) {
    <div class="loading-state">
      <ion-spinner></ion-spinner>
      <p>Cargando animales...</p>
    </div>
    } @else if (filteredAnimals().length === 0 && animals().length > 0) {
    <div class="empty-state ion-padding ion-text-center">
      <ion-icon name="filter-outline" size="large"></ion-icon>
      <h3>No se encontraron animales</h3>
      <p>No hay animales que coincidan con los filtros seleccionados.</p>
      <ion-button fill="clear" (click)="onFiltersCleared()">
        Limpiar filtros
      </ion-button>
    </div>
    } @else if (animals().length === 0) {
    <div class="empty-state ion-padding ion-text-center">
      <ion-icon name="paw-outline" size="large"></ion-icon>
      <h3>No hay animales registrados</h3>
      <p>Comienza creando tu primer animal.</p>
      @if (canCreateAnimals()) {
      <ion-button expand="block" [routerLink]="['/animal/create']">
        <ion-icon slot="start" name="add-outline"></ion-icon>
        Crear Animal
      </ion-button>
      } @else {
      <ion-badge color="warning"
        >Permisos insuficientes para crear animales</ion-badge
      >
      }
    </div>
    } @else {
    <ion-grid>
      <ion-row>
        @for (animal of filteredAnimals(); track animal.id) {
        <ion-col size="12" size-sm="6" size-md="4">
          <ion-card>
            <ion-card-header>
              <ion-card-title>{{ animal.breed }}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <div class="animal-info">
                <p>
                  <ion-icon name="calendar-outline" color="medium"></ion-icon>
                  <strong>Nacimiento:</strong> {{ animal.birth_date |
                  date:'short' }}
                </p>
                <p>
                  <ion-icon name="pulse-outline" color="medium"></ion-icon>
                  <strong>Estado:</strong> {{ animal.status }}
                </p>
              </div>

              <div class="action-buttons">
                <ion-button
                  fill="outline"
                  size="small"
                  (click)="goToSpecificAnimal(animal)"
                >
                  <ion-icon slot="start" name="eye-outline"></ion-icon>
                  Ver
                </ion-button>
                @if (canEditAnimals()) {
                <ion-button
                  fill="clear"
                  size="small"
                  (click)="goToEdit(animal)"
                >
                  <ion-icon slot="start" name="pencil-outline"></ion-icon>
                  Editar
                </ion-button>
                }
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
        }
      </ion-row>
    </ion-grid>
    }
  </div>

  <!-- Floating Action Button -->
  @if (canCreateAnimals()) {
  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button [routerLink]="['/animal/create']">
      <ion-icon name="add-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  }
</ion-content>
