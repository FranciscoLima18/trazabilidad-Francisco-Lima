<form (ngSubmit)="onSubmit()" #landForm="ngForm">
  <ion-grid>
    <!-- Nombre del predio -->
    <ion-row class="ion-justify-content-center">
      <ion-col size="12" size-sm="8" size-md="6">
        <ion-item>
          <ion-label position="floating">Nombre del Predio *</ion-label>
          <ion-input
            fill="solid"
            [value]="name()"
            (ionInput)="name.set($event.detail.value!)"
            (ionBlur)="validateName()"
            name="name"
            required
            minlength="3"
            [class.ion-invalid]="!!nameError()"
            [class.ion-touched]="true"
          >
          </ion-input>
        </ion-item>
        @if(nameError()) {
        <ion-text color="danger">
          <small>{{ nameError() }}</small>
        </ion-text>
        }
      </ion-col>
    </ion-row>

    <!-- Latitud -->
    <ion-row class="ion-justify-content-center">
      <ion-col size="12" size-sm="8" size-md="6">
        <ion-item>
          <ion-label position="floating">Latitud (-90 a 90) *</ion-label>
          <ion-input
            fill="solid"
            type="number"
            step="0.000001"
            [value]="latitude()"
            (ionInput)="
              latitude.set(
                $event.detail.value ? parseFloat($event.detail.value) : null
              )
            "
            (ionBlur)="validateLatitude()"
            name="latitude"
            required
            min="-90"
            max="90"
            [class.ion-invalid]="!!latitudeError()"
            [class.ion-touched]="true"
          >
          </ion-input>
        </ion-item>
        @if(latitudeError()) {
        <ion-text color="danger">
          <small>{{ latitudeError() }}</small>
        </ion-text>
        } @if(!latitudeError() && latitude() !== null) {
        <ion-text color="medium">
          <small>Ejemplo: Uruguay está entre -30° y -35° de latitud</small>
        </ion-text>
        }
      </ion-col>
    </ion-row>

    <!-- Longitud -->
    <ion-row class="ion-justify-content-center">
      <ion-col size="12" size-sm="8" size-md="6">
        <ion-item>
          <ion-label position="floating">Longitud (-180 a 180) *</ion-label>
          <ion-input
            fill="solid"
            type="number"
            step="0.000001"
            [value]="longitude()"
            (ionInput)="
              longitude.set(
                $event.detail.value ? parseFloat($event.detail.value) : null
              )
            "
            (ionBlur)="validateLongitude()"
            name="longitude"
            required
            min="-180"
            max="180"
            [class.ion-invalid]="!!longitudeError()"
            [class.ion-touched]="true"
          >
          </ion-input>
        </ion-item>
        @if(longitudeError()) {
        <ion-text color="danger">
          <small>{{ longitudeError() }}</small>
        </ion-text>
        } @if(!longitudeError() && longitude() !== null) {
        <ion-text color="medium">
          <small>Ejemplo: Uruguay está entre -53° y -58° de longitud</small>
        </ion-text>
        }
      </ion-col>
    </ion-row>

    <!-- Imagen del predio -->
    <ion-row class="ion-justify-content-center">
      <ion-col size="12" size-sm="8" size-md="6">
        <ion-item lines="none">
          <ion-label position="stacked">Imagen del predio</ion-label>
        </ion-item>

        <div class="file-upload-container">
          @if(!previewUrl()) {
          <ion-button
            expand="block"
            color="medium"
            class="upload-button"
            (click)="fileInput.click()"
          >
            <ion-icon name="image-outline" slot="start"></ion-icon>
            Seleccionar imagen
          </ion-button>
          } @else {
          <div class="image-preview-container">
            <img
              [src]="previewUrl()"
              alt="Vista previa del predio"
              class="image-preview"
            />
            <div class="image-actions">
              <ion-button
                fill="clear"
                color="medium"
                (click)="fileInput.click()"
              >
                <ion-icon name="reload-outline" slot="icon-only"></ion-icon>
              </ion-button>
              <ion-button fill="clear" color="danger" (click)="removeImage()">
                <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
          }
          <input
            #fileInput
            type="file"
            class="file-input-hidden"
            (change)="onFileSelected($event)"
            accept="image/*"
          />
        </div>

        @if(selectedFile) {
        <ion-text color="medium" class="file-info">
          <small
            >{{ selectedFile.name }} ({{
              (selectedFile.size / 1024).toFixed(1)
            }}
            KB)</small
          >
        </ion-text>
        }
      </ion-col>
    </ion-row>

    <!-- Botón Guardar -->
    <ion-row class="ion-justify-content-center">
      <ion-col size="12" size-sm="8" size-md="6">
        <ion-button
          expand="block"
          shape="round"
          type="submit"
          [disabled]="!isFormValid() || isSubmitting()"
        >
          @if(isSubmitting()) { Guardando... } @else {
          {{ land() ? "Actualizar" : "Crear" }} Predio }
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>
</form>
